<html>
   <head>
      <meta charset="utf-8" />

      <title>{{ title }}</title>

      <link rel='stylesheet' href='static/css/jquery-ui.min.css' />
      <link rel='stylesheet' href='static/css/bootstrap.min.css' />

      <style>
        #header {
          margin: 5px;
        }

        #tableDiv {
          margin: 5px;
        }
      </style>
   </head>
   <body>
     <div id="header">
       <h4>Matka.fi GTFS reittien haku</h4>
       <button onclick="location.href='/';" class="btn btn-primary btn-sm">Siirry takaisin</button>

       <br />
       <br />

       <input placeholder="Syötä reitin nimi" type="text" id="route">

       <br />
       <br />
     </div>

     <div id="tableDiv">
       <table class="table">
         <thead>
           <th>Reitin ID</th>
           <th>Reitin tarjoaja</th>
           <th>Reitin lyhyt nimi</th>
           <th>Reitin pitkä nimi</th>
           <th>Linkki tarjoajan sivuille</th>
         </thead>
         <tbody id="tableContent">
         </tbody>
       </table>
     </div>

     <script src='static/js/jquery-2.2.4.min.js'></script>
     <script src='static/js/bootstrap.min.js'></script>

     <script>
      $("#route").change(function() {
        $('#tableContent').empty();
        var value = $( this ).val();

        if (!value.trim()) {
          console.log('Anna hakusana')
        } else {
          $.ajax({
            url: "/routes",
            type: "POST",
            data: { routeName: value },
            cache: false,

            success: (res) => {
              console.log('Query succeeded!')
              response = JSON.parse("[" + res + "]")
              if (response[0].length !== 0) {
                for (i = 0; i < response[0].length; i++) {
                  $("#tableContent").append(
                    `<tr>
                      <td>${response[0][i].route_id}</td>
                      <td>${response[0][i].agency_name}</td>
                      <td>${response[0][i].route_short_name}</td>
                      <td>${response[0][i].route_long_name}</td>
                      <td><a href="${response[0][i].agency_url}" target="_blank">${response[0][i].agency_name}</a></td>
                    </tr>`
                  )
                }
              }
            },

            error: () => {
              console.log('ERROOOR!');
            }
          });
        }

      });
     </script>
   </body>
 </html>
